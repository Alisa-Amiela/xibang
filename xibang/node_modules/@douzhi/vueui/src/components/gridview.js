Vue.component("dz-grid-view", {
  props: {
    dataUrl: String,
    page: {
      type: String,
      default: "false"
    }
  },
  data() {
    return {
      records: []
    };
  },
  template: `<table lay-filter="dz-table" :lay-data="'{page:'+page+'}'"><slot :data="records"></slot></table>`,
  mounted() {
    layui.use(["table"], () => {
      let table = layui.table;
      let $ = layui.$;
      table.init("dz-table");
      table.on("tool(dz-table)", obj => {
        let layEvent = obj.event;
        if (layEvent === "del") {
          let url = obj.tr.find("[delete-url]").attr("delete-url");
          layer.confirm(
            "您确认删除么？",
            {
              btn: ["确认", "取消"]
            },
            index => {
              axios
                .get(url)
                .then(() => {
                  layer.close(index);
                  table.init("dz-table");
                })
                .catch(error => {
                  layer.close(index);
                  layer.msg("网络异常，请检查接口是否正常运行");
                });
            }
          );
        }
      });
      if (this.$props.dataUrl) {
        this.getRecords(this.$props.dataUrl).then(rps => {
          this.records = rps.data;
          this.$nextTick(() => {
            table.init("dz-table");
          });
        });
      }
    });
  },
  methods: {
    getRecords: function(url) {
      return axios.get(url);
    }
  }
});
